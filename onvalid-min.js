//      onvalid.js 0.2.1
//      Copyright (c) 2010 Mark Doffman, Codethink Ltd
//      Onvalid may be freely distributed under the MIT license.
(function(){typeof exports!="undefined"?a=exports:a=this.Onvalid={};var a=exports;a.VERSION="0.2.1";var b=this._;!b&&typeof require!="undefined"&&(b=require("underscore")._),a.validate=function(b,c,d){return a.schema(c)(b,d)};var c=function(c){return b.isFunction(c)?c:b.isRegExp(c)?a.regex(c):b.isArray(c)||b.isString(c)||b.isNumber(c)?a.eq(c):a.schema(c)},d=a.errWrapper=function(a,b){return function(c,d){var e=a(c);return!e&&d&&b&&d(b),e}};a.schema=function(a){return function(d,e){return b.isUndefined(d)?!1:b.every(b.keys(a),function(b){var f="",g=c(a[b])(d[b],function(a){f=a});return!g&&e&&e("Property at "+b+" is not valid: "+f),g})}},a.regex=function(a){return d(function(b){return a.test(b)},"must match regex "+a)},a.email=a.regex(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/),a.or=function(a){return d(function(d){return b.any(a,function(a){return c(a)(d)})},"must match at-least one of the constraints")},a.and=function(a){return function(d,e){return b.every(a,function(a,b){var f="",g=c(a)(d,function(a){f=a});return!g&&e&&e("constraint at position "+(b+1)+" is not met: "+f),g})}},a.nor=function(a){return function(d,e){return b.every(a,function(a,b){var f=c(a)(d);return f&&e&&e("constraint at position "+(b+1)+" must not be met"),!f})}},a.opt=function(a){return function(d,e){return b.isUndefined(d)?!0:c(a)(d,e)}},a.notExists=d(function(a){return b.isUndefined(a)},"must not exist"),a.exists=d(function(a){return!b.isUndefined(a)},"must exist"),a.all=function(a){return d(function(c){return b.isArray(c)?b.every(c,function(c){return b.contains(c,a)}):!1},"must match all of "+a)},a._in=function(a){return d(function(c){return b.contains(c,a)},"must be contained in "+a)},a.nin=function(a){return d(function(c){return b.every(a,function(a){return!b.isEqual(c,a)})},"must not be contained in"+a)},a.eq=function(a){return d(function(c){return b.isEqual(c,a)},"must be equal to "+a)},a.ne=function(a){return d(function(c){return!b.isEqual(c,a)},"must not be equal to "+a)},a.mod=function(a){return d(function(b){return b%a===0},"must be wholely divisible by "+a)},a.gt=function(a){return d(function(b){return b>a},"must be greater than "+a)},a.lt=function(a){return d(function(b){return b<a},"must be less than "+a)},a.gte=function(a){return d(function(b){return b>=a},"must be greater than or equal to "+a)},a.lte=function(a){return d(function(b){return b<=a},"must be less than or equal to "+a)}})();